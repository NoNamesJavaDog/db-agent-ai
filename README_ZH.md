[English](README.md) | **ä¸­æ–‡**

# DB Agent - æ•°æ®åº“æ™ºèƒ½åŠ©æ‰‹

> **è®© DBA å¤±ä¸šçš„ AI æ•°æ®åº“ç®¡ç†ä¸“å®¶** â€”â€” è‡ªç„¶è¯­è¨€æ“ä½œæ•°æ®åº“ï¼ŒSQL ä¼˜åŒ–ã€æ€§èƒ½è¯Šæ–­ã€æ•°æ®ç®¡ç†ä¸€å¥è¯æå®š

[![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)](https://python.org)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-12+-336791.svg)](https://postgresql.org)
[![MySQL](https://img.shields.io/badge/MySQL-5.7%20%7C%208.0-4479A1.svg)](https://mysql.com)
[![Oracle](https://img.shields.io/badge/Oracle-12c+-F80000.svg)](https://www.oracle.com/database/)
[![SQL Server](https://img.shields.io/badge/SQL%20Server-2014+-CC2927.svg)](https://www.microsoft.com/sql-server)
[![GaussDB](https://img.shields.io/badge/GaussDB-é›†ä¸­å¼%20%7C%20åˆ†å¸ƒå¼-red.svg)](https://www.huaweicloud.com/product/gaussdb.html)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)

---

## ğŸ“– ç›®å½•

- [äº§å“ä»‹ç»](#-äº§å“ä»‹ç»)
- [æ ¸å¿ƒåŠŸèƒ½](#-æ ¸å¿ƒåŠŸèƒ½)
- [ç³»ç»Ÿæ¶æ„](#-ç³»ç»Ÿæ¶æ„)
- [å®‰è£…éƒ¨ç½²](#-å®‰è£…éƒ¨ç½²)
- [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)
- [ä½¿ç”¨åœºæ™¯](#-ä½¿ç”¨åœºæ™¯)
- [é…ç½®è¯´æ˜](#-é…ç½®è¯´æ˜)
- [API æœåŠ¡](#-api-æœåŠ¡)
- [å¸¸è§é—®é¢˜](#-å¸¸è§é—®é¢˜)

---

## ğŸ¯ äº§å“ä»‹ç»

**DB Agent** æ˜¯ä¸€æ¬¾é©å‘½æ€§çš„ AI æ•°æ®åº“ç®¡ç†åŠ©æ‰‹ï¼Œå®ƒå°†å¤æ‚çš„æ•°æ®åº“æ“ä½œè½¬åŒ–ä¸ºç®€å•çš„è‡ªç„¶è¯­è¨€å¯¹è¯ã€‚æ— è®ºä½ æ˜¯å¼€å‘è€…ã€æ•°æ®åˆ†æå¸ˆè¿˜æ˜¯äº§å“ç»ç†ï¼Œéƒ½å¯ä»¥é€šè¿‡ä¸ AI å¯¹è¯çš„æ–¹å¼å®Œæˆæ•°æ®åº“çš„å¢åˆ æ”¹æŸ¥ã€æ€§èƒ½ä¼˜åŒ–ã€ç»“æ„è®¾è®¡ç­‰å·¥ä½œã€‚

### ä¸ºä»€ä¹ˆé€‰æ‹© DB Agentï¼Ÿ

| ä¼ ç»Ÿ DBA æ–¹å¼ | DB Agent æ–¹å¼ |
|--------------|---------------|
| éœ€è¦ç²¾é€š SQL è¯­æ³• | ç”¨è‡ªç„¶è¯­è¨€æè¿°éœ€æ±‚ |
| æ‰‹åŠ¨åˆ†ææ‰§è¡Œè®¡åˆ’ | AI è‡ªåŠ¨è¯Šæ–­æ€§èƒ½é—®é¢˜ |
| æŸ¥é˜…æ–‡æ¡£ç¼–å†™å¤æ‚æŸ¥è¯¢ | ä¸€å¥è¯ç”Ÿæˆä¼˜åŒ– SQL |
| éœ€è¦äº†è§£è¡¨ç»“æ„æ‰èƒ½æ“ä½œ | AI è‡ªåŠ¨æ¢ç´¢æ•°æ®åº“ç»“æ„ |
| ç´¢å¼•ä¼˜åŒ–éœ€è¦ä¸°å¯Œç»éªŒ | æ™ºèƒ½æ¨èæœ€ä½³ç´¢å¼•ç­–ç•¥ |
| æ‰‹åŠ¨è½¬æ¢å¼‚æ„æ•°æ®åº“ DDL | AI è‡ªåŠ¨è½¬æ¢å¹¶æ‰§è¡Œå¯¹è±¡è¿ç§» |
| 7x24 å°æ—¶å¾…å‘½ | AI æ°¸ä¸ç–²å€¦éšæ—¶å“åº” |

### æ ¸å¿ƒä¼˜åŠ¿

- **ğŸ§  æ™ºèƒ½ç†è§£** - åŸºäºå¤§è¯­è¨€æ¨¡å‹ï¼ŒçœŸæ­£ç†è§£ä½ çš„æ„å›¾
- **ğŸ”’ å®‰å…¨å¯æ§** - å±é™©æ“ä½œéœ€äºŒæ¬¡ç¡®è®¤ï¼Œæœç»è¯¯æ“ä½œ
- **ğŸ”„ é”™è¯¯æ¢å¤** - è‡ªåŠ¨åˆ†ææ‰§è¡Œå¤±è´¥åŸå› ï¼Œæ™ºèƒ½è°ƒæ•´ç­–ç•¥é‡è¯•
- **ğŸŒ å¤šæ¨¡å‹æ”¯æŒ** - æ”¯æŒ DeepSeekã€OpenAIã€Claudeã€Geminiã€é€šä¹‰åƒé—®ç­‰ä¸»æµæ¨¡å‹
- **ğŸ‡¨ğŸ‡³ ä¸­è‹±åŒè¯­** - å®Œç¾æ”¯æŒä¸­æ–‡äº¤äº’ï¼Œå‘Šåˆ«è¯­è¨€éšœç¢
- **ğŸ“Š ç‰ˆæœ¬æ„ŸçŸ¥** - è‡ªåŠ¨è¯†åˆ«æ•°æ®åº“ç‰ˆæœ¬ï¼Œç”Ÿæˆå…¼å®¹çš„ SQL
- **âš¡ å®æ—¶åé¦ˆ** - å·¥å…·è°ƒç”¨è¿‡ç¨‹é€æ˜å¯è§ï¼Œæ‰§è¡Œç»“æœå³æ—¶å±•ç¤º
- **ğŸ’¾ ä¼šè¯ç®¡ç†** - åŸºäº SQLite çš„å¯¹è¯å†å²æŒä¹…åŒ–å­˜å‚¨
- **ğŸ”Œ å¤šè¿æ¥ç®¡ç†** - æ”¯æŒå¤šä¸ªæ•°æ®åº“è¿æ¥ï¼Œéšæ—¶åˆ‡æ¢

---

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½

### 1. æ•°æ®æŸ¥è¯¢ä¸æ“ä½œ
```
ğŸ‘¤ ç”¨æˆ·: æŸ¥çœ‹ users è¡¨é‡Œä¸Šä¸ªæœˆæ³¨å†Œçš„ç”¨æˆ·æœ‰å¤šå°‘
ğŸ¤– Agent: æ­£åœ¨æŸ¥è¯¢... ä¸Šä¸ªæœˆå…±æœ‰ 1,234 ä½æ–°ç”¨æˆ·æ³¨å†Œ

ğŸ‘¤ ç”¨æˆ·: æŠŠçŠ¶æ€ä¸º inactive ä¸”è¶…è¿‡ä¸€å¹´æ²¡ç™»å½•çš„ç”¨æˆ·æ ‡è®°ä¸º archived
ğŸ¤– Agent: è¿™ä¸ªæ“ä½œä¼šå½±å“ 856 æ¡è®°å½•ï¼Œç¡®è®¤æ‰§è¡Œå—ï¼Ÿ[æ˜¯/å¦]
```

### 2. è¡¨ç»“æ„ç®¡ç†
```
ğŸ‘¤ ç”¨æˆ·: å¸®æˆ‘åˆ›å»ºä¸€ä¸ªå•†å“è¡¨ï¼ŒåŒ…å«åç§°ã€ä»·æ ¼ã€åº“å­˜ã€åˆ†ç±»
ğŸ¤– Agent: å¥½çš„ï¼Œæˆ‘æ¥åˆ›å»º products è¡¨...
         [å±•ç¤ºå»ºè¡¨ SQLï¼Œç­‰å¾…ç¡®è®¤]

ğŸ‘¤ ç”¨æˆ·: ç»™ orders è¡¨åŠ ä¸€ä¸ª shipping_address å­—æ®µ
ğŸ¤– Agent: å·²æ·»åŠ  shipping_address å­—æ®µ (VARCHAR(500))
```

### 3. æ€§èƒ½è¯Šæ–­ä¸ä¼˜åŒ–
```
ğŸ‘¤ ç”¨æˆ·: è¿™ä¸ªæŸ¥è¯¢å¾ˆæ…¢ï¼Œå¸®æˆ‘åˆ†æä¸€ä¸‹ï¼šSELECT * FROM orders WHERE user_id = 123
ğŸ¤– Agent: åˆ†æç»“æœï¼š
         âŒ é—®é¢˜ï¼šuser_id åˆ—ç¼ºå°‘ç´¢å¼•ï¼Œå¯¼è‡´å…¨è¡¨æ‰«æ
         âœ… å»ºè®®ï¼šCREATE INDEX idx_orders_user_id ON orders(user_id)
         ğŸ“ˆ é¢„æœŸæå‡ï¼šæŸ¥è¯¢é€Ÿåº¦æå‡ 50-100 å€
```

### 4. ç´¢å¼•ç®¡ç†
```
ğŸ‘¤ ç”¨æˆ·: æ£€æŸ¥ orders è¡¨çš„ç´¢å¼•ä½¿ç”¨æƒ…å†µ
ğŸ¤– Agent: å‘ç° 3 ä¸ªç´¢å¼•ï¼š
         âœ… idx_orders_pkey - ä½¿ç”¨é¢‘ç¹ (125,000 æ¬¡æ‰«æ)
         âœ… idx_orders_user_id - ä½¿ç”¨æ­£å¸¸ (45,000 æ¬¡æ‰«æ)
         âš ï¸ idx_orders_old_status - ä»æœªä½¿ç”¨ï¼Œå»ºè®®åˆ é™¤ (èŠ‚çœ 128MB)
```

### 5. æ•°æ®åº“å¥åº·æ£€æŸ¥
```
ğŸ‘¤ ç”¨æˆ·: æ£€æŸ¥æ•°æ®åº“çš„æ•´ä½“å¥åº·çŠ¶æ€
ğŸ¤– Agent: å¥åº·æŠ¥å‘Šï¼š
         ğŸ“Š è¡¨æ•°é‡ï¼š23 ä¸ª
         ğŸ’¾ æ€»å¤§å°ï¼š4.5 GB
         âš ï¸ å‘ç° 3 ä¸ªè¡¨æœ‰å¤§é‡æ­»å…ƒç»„ï¼Œå»ºè®®æ‰§è¡Œ VACUUM
         âš ï¸ æœ‰ 2 ä¸ªæ…¢æŸ¥è¯¢éœ€è¦ä¼˜åŒ–
```

### 6. åœ¨çº¿æ•°æ®åº“è¿ç§»
```
ğŸ‘¤ ç”¨æˆ·: /migrate
[é€‰æ‹©: 2. åœ¨çº¿è¿ç§»]
[é€‰æ‹©æºæ•°æ®åº“: mysql-test]

ğŸ¤– Agent: æ­£åœ¨åˆ†ææºæ•°æ®åº“ mysql-test...
         å‘ç° 7 ä¸ªè¡¨, 3 ä¸ªè§†å›¾, 3 ä¸ªå­˜å‚¨è¿‡ç¨‹, 3 ä¸ªå‡½æ•°, 3 ä¸ªè§¦å‘å™¨

         è¿ç§»è®¡åˆ’ï¼š
         | # | ç±»å‹ | å¯¹è±¡ | çŠ¶æ€ |
         |---|------|------|------|
         | 1 | è¡¨ | users | å¾…æ‰§è¡Œ |
         | 2 | è¡¨ | departments | å¾…æ‰§è¡Œ |
         | ... | ... | ... | ... |

         ç¡®è®¤æ‰§è¡Œè¿ç§»ï¼Ÿ[æ˜¯/å¦]

ğŸ‘¤ ç”¨æˆ·: æ˜¯

ğŸ¤– Agent: æ­£åœ¨æ‰§è¡Œè¿ç§»...
         âœ“ åˆ›å»ºè¡¨ users
         âœ“ åˆ›å»ºè¡¨ departments
         âœ“ åˆ›å»ºè¡¨ employees
         ...
         è¿ç§»å®Œæˆï¼š19/19 ä¸ªå¯¹è±¡è¿ç§»æˆåŠŸ
```

---

## ğŸ— ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DB Agent                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   CLI ç•Œé¢   â”‚  â”‚  API æœåŠ¡   â”‚  â”‚  Web ç•Œé¢   â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â”‚                â”‚                â”‚                 â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                          â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   SQLTuningAgent                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚ å¯¹è¯ç®¡ç†å™¨   â”‚  â”‚  å·¥å…·æ‰§è¡Œå™¨  â”‚  â”‚ å®‰å…¨ç¡®è®¤æœºåˆ¶  â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â”‚                                  â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚         â–¼                â–¼                â–¼            â–¼   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ LLM å®¢æˆ·ç«¯   â”‚  â”‚ æ•°æ®åº“å·¥å…·   â”‚  â”‚ å›½é™…åŒ– â”‚ â”‚ æ•°æ®å­˜å‚¨  â”‚ â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚  â”‚ â€¢ DeepSeek  â”‚  â”‚ â€¢ æŸ¥è¯¢æ‰§è¡Œ   â”‚            â”‚ SQLite   â”‚ â”‚
â”‚  â”‚ â€¢ OpenAI    â”‚  â”‚ â€¢ è¡¨ç»“æ„ç®¡ç† â”‚            â”‚ â€¢ ä¼šè¯   â”‚ â”‚
â”‚  â”‚ â€¢ Claude    â”‚  â”‚ â€¢ ç´¢å¼•åˆ†æ   â”‚            â”‚ â€¢ æ¶ˆæ¯   â”‚ â”‚
â”‚  â”‚ â€¢ Gemini    â”‚  â”‚ â€¢ å¯¹è±¡è¿ç§»   â”‚            â”‚ â€¢ è¿æ¥   â”‚ â”‚
â”‚  â”‚ â€¢ Qwen      â”‚  â”‚ â€¢ æ€§èƒ½è¯Šæ–­   â”‚            â”‚ â€¢ é…ç½®   â”‚ â”‚
â”‚  â”‚ â€¢ Ollama    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚                                 â”‚
â”‚                          â–¼                                  â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                   â”‚ PostgreSQL  â”‚                          â”‚
â”‚                   â”‚   MySQL     â”‚                          â”‚
â”‚                   â”‚   Oracle    â”‚                          â”‚
â”‚                   â”‚ SQL Server  â”‚                          â”‚
â”‚                   â”‚   GaussDB   â”‚                          â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é¡¹ç›®ç»“æ„

```
ai_agent/
â”œâ”€â”€ db_agent/                      # ä¸»ç¨‹åºåŒ…
â”‚   â”œâ”€â”€ __init__.py                # åŒ…å¯¼å‡º
â”‚   â”œâ”€â”€ core/                      # æ ¸å¿ƒç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ agent.py               # SQLTuningAgent æ™ºèƒ½ä½“
â”‚   â”‚   â”œâ”€â”€ migration_rules.py     # DDL è½¬æ¢è§„åˆ™
â”‚   â”‚   â””â”€â”€ database/              # æ•°æ®åº“æŠ½è±¡å±‚
â”‚   â”‚       â”œâ”€â”€ base.py            # åŸºç±»ï¼ˆæ¥å£å®šä¹‰ï¼‰
â”‚   â”‚       â”œâ”€â”€ postgresql.py      # PostgreSQL å®ç°
â”‚   â”‚       â”œâ”€â”€ mysql.py           # MySQL å®ç°
â”‚   â”‚       â”œâ”€â”€ oracle.py          # Oracle å®ç°ï¼ˆ12c+ï¼‰
â”‚   â”‚       â”œâ”€â”€ sqlserver.py       # SQL Server å®ç°ï¼ˆ2014+ï¼‰
â”‚   â”‚       â”œâ”€â”€ gaussdb.py         # GaussDB å®ç°ï¼ˆé›†ä¸­å¼/åˆ†å¸ƒå¼ï¼‰
â”‚   â”‚       â””â”€â”€ factory.py         # æ•°æ®åº“å·¥å…·å·¥å‚
â”‚   â”œâ”€â”€ llm/                       # LLM å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ base.py                # åŸºç±»
â”‚   â”‚   â”œâ”€â”€ openai_compatible.py   # OpenAI/DeepSeek/Qwen/Ollama
â”‚   â”‚   â”œâ”€â”€ claude.py              # Anthropic Claude
â”‚   â”‚   â”œâ”€â”€ gemini.py              # Google Gemini
â”‚   â”‚   â””â”€â”€ factory.py             # å®¢æˆ·ç«¯å·¥å‚
â”‚   â”œâ”€â”€ storage/                   # æ•°æ®æŒä¹…åŒ–ï¼ˆSQLiteï¼‰
â”‚   â”‚   â”œâ”€â”€ __init__.py            # åŒ…å¯¼å‡º
â”‚   â”‚   â”œâ”€â”€ models.py              # æ•°æ®æ¨¡å‹ï¼ˆä¼šè¯ã€æ¶ˆæ¯ã€è¿æ¥ç­‰ï¼‰
â”‚   â”‚   â”œâ”€â”€ sqlite_storage.py      # SQLite å­˜å‚¨å®ç°
â”‚   â”‚   â””â”€â”€ encryption.py          # å¯†ç åŠ å¯†å·¥å…·
â”‚   â”œâ”€â”€ api/                       # API æœåŠ¡
â”‚   â”‚   â””â”€â”€ server.py              # FastAPI åº”ç”¨
â”‚   â”œâ”€â”€ cli/                       # å‘½ä»¤è¡Œç•Œé¢
â”‚   â”‚   â”œâ”€â”€ app.py                 # CLI åº”ç”¨
â”‚   â”‚   â””â”€â”€ config.py              # é…ç½®ç®¡ç†
â”‚   â””â”€â”€ i18n/                      # å›½é™…åŒ–
â”‚       â””â”€â”€ translations.py        # ç¿»è¯‘æ–‡ä»¶
â”œâ”€â”€ scripts/                       # å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ start.sh                   # Linux/macOS
â”‚   â””â”€â”€ start.bat                  # Windows
â”œâ”€â”€ examples/                      # ç¤ºä¾‹ä»£ç 
â”‚   â””â”€â”€ examples.py
â”œâ”€â”€ main.py                        # ç¨‹åºå…¥å£
â”œâ”€â”€ requirements.txt               # ä¾èµ–æ¸…å•
â””â”€â”€ README.md                      # è¯´æ˜æ–‡æ¡£
```

---

## ğŸ“¦ å®‰è£…éƒ¨ç½²

### ç¯å¢ƒè¦æ±‚

- Python 3.8+
- PostgreSQL 12+ã€MySQL 5.7/8.0ã€Oracle 12c+ã€SQL Server 2014+ æˆ– GaussDBï¼ˆé›†ä¸­å¼/åˆ†å¸ƒå¼ï¼‰
- è‡³å°‘ä¸€ä¸ª LLM API Keyï¼ˆDeepSeek / OpenAI / Claude ç­‰ï¼‰

> **GaussDB ç”¨æˆ·æ³¨æ„ï¼š** GaussDB ä½¿ç”¨ pg8000 é©±åŠ¨ï¼ˆæ”¯æŒ sha256 è®¤è¯ï¼‰ã€‚Linuxï¼ˆæ¬§æ‹‰ç³»ç»Ÿï¼‰ä¹Ÿå¯ä½¿ç”¨åä¸ºæä¾›çš„ä¸“ç”¨é©±åŠ¨ã€‚è¯¦è§ [GaussDB é…ç½®](#gaussdbåä¸º) ç« èŠ‚ã€‚

> **Oracle ç”¨æˆ·æ³¨æ„ï¼š** ä½¿ç”¨ `oracledb` Thin æ¨¡å¼ï¼ˆOracle å®˜æ–¹ Python é©±åŠ¨ï¼‰- æ— éœ€å®‰è£… Oracle Clientã€‚æ”¯æŒ Oracle 12c åŠä»¥ä¸Šç‰ˆæœ¬ï¼ˆ12.1ã€12.2ã€18cã€19cã€21cã€23cï¼‰ã€‚ä¸æ”¯æŒ Oracle 11gã€‚

> **SQL Server ç”¨æˆ·æ³¨æ„ï¼š** ä½¿ç”¨ `pytds` (python-tds) - çº¯ Python é©±åŠ¨ï¼Œæ— éœ€å®‰è£… ODBCã€‚æ”¯æŒ SQL Server 2014 è‡³ 2022 åŠ Azure SQL Databaseã€‚Query Store åŠŸèƒ½éœ€è¦ SQL Server 2016+ã€‚

### æ–¹å¼ä¸€ï¼šç›´æ¥å®‰è£…

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/NoNamesJavaDog/db-agent-ai.git
cd db-agent

# 2. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 3. é…ç½®
cp config/config.ini.example config/config.ini
# ç¼–è¾‘ config/config.iniï¼Œå¡«å†™æ•°æ®åº“è¿æ¥ä¿¡æ¯å’Œ API Key

# 4. å¯åŠ¨
python main.py
```

### æ–¹å¼äºŒï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬

**Linux / macOS:**
```bash
chmod +x scripts/start.sh
./scripts/start.sh
```

**Windows:**
```cmd
scripts\start.bat
```

### ä¾èµ–æ¸…å•

```
requirements.txt
â”œâ”€â”€ pg8000           # PostgreSQL/GaussDB é©±åŠ¨ï¼ˆæ”¯æŒ sha256 è®¤è¯ï¼‰
â”œâ”€â”€ pymysql          # MySQL é©±åŠ¨
â”œâ”€â”€ oracledb         # Oracle é©±åŠ¨ï¼ˆThin æ¨¡å¼ï¼Œæ— éœ€å®¢æˆ·ç«¯ï¼‰
â”œâ”€â”€ python-tds       # SQL Server é©±åŠ¨ï¼ˆçº¯ Pythonï¼Œæ— éœ€ ODBCï¼‰
â”œâ”€â”€ pydantic         # æ•°æ®éªŒè¯ï¼ˆ>=2.10.0 æ”¯æŒ Python 3.13ï¼‰
â”œâ”€â”€ openai           # OpenAI/DeepSeek API
â”œâ”€â”€ anthropic        # Claude API
â”œâ”€â”€ google-generativeai  # Gemini API
â”œâ”€â”€ rich             # ç»ˆç«¯ç¾åŒ–
â”œâ”€â”€ prompt-toolkit   # å‘½ä»¤è¡Œå¢å¼º
â”œâ”€â”€ fastapi          # API æœåŠ¡
â””â”€â”€ uvicorn          # ASGI æœåŠ¡å™¨
```

### æ–¹å¼ä¸‰ï¼šå†…ç½‘ç¦»çº¿éƒ¨ç½²

é€‚ç”¨äºæ— æ³•è®¿é—®å¤–ç½‘çš„å†…ç½‘ç¯å¢ƒã€‚

#### æ–¹æ¡ˆ Aï¼šæ‰“åŒ…æˆç‹¬ç«‹å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆæ¨èï¼‰

æ— éœ€åœ¨ç›®æ ‡æœºå™¨å®‰è£… Pythonï¼Œç›´æ¥è¿è¡Œ exe æ–‡ä»¶ã€‚

**åœ¨è”ç½‘æœºå™¨ä¸Šæ‰“åŒ…ï¼š**
```bash
# 1. å®‰è£… PyInstaller
pip install pyinstaller

# 2. è¿è¡Œæ‰“åŒ…è„šæœ¬
scripts\build_package.bat      # Windows
# æˆ–
./scripts/build_package.sh     # Linux/macOS
```

**æ‰“åŒ…è¾“å‡ºï¼š**
```
dist/db-agent/
â”œâ”€â”€ db-agent.exe          # ä¸»ç¨‹åºï¼ˆWindowsï¼‰æˆ– db-agentï¼ˆLinuxï¼‰
â”œâ”€â”€ config/
â”‚   â””â”€â”€ config.ini.example
â””â”€â”€ ... (è¿è¡Œæ—¶ä¾èµ–)
```

**éƒ¨ç½²åˆ°ç›®æ ‡æœºå™¨ï¼š**
1. å°† `dist/db-agent/` æ•´ä¸ªæ–‡ä»¶å¤¹å¤åˆ¶åˆ°ç›®æ ‡æœºå™¨
2. ç¼–è¾‘ `config/config.ini` é…ç½®æ•°æ®åº“å’Œ API Key
3. è¿è¡Œ `db-agent.exe`

#### æ–¹æ¡ˆ Bï¼šç¦»çº¿ pip å®‰è£…

ç›®æ ‡æœºå™¨éœ€è¦æœ‰ Python ç¯å¢ƒï¼Œä½†æ— éœ€è”ç½‘ã€‚

**åœ¨è”ç½‘æœºå™¨ä¸Šä¸‹è½½ä¾èµ–ï¼š**
```bash
scripts\download_deps.bat      # Windows
```

**æ‰“åŒ…å†…å®¹ï¼š**
```
é¡¹ç›®ç›®å½•/
â”œâ”€â”€ vendor/               # æ‰€æœ‰ä¾èµ–çš„ wheel åŒ…
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ install_offline.bat   # ç¦»çº¿å®‰è£…è„šæœ¬
â””â”€â”€ ... (æºä»£ç )
```

**éƒ¨ç½²åˆ°ç›®æ ‡æœºå™¨ï¼š**
1. å°†æ•´ä¸ªé¡¹ç›®æ–‡ä»¶å¤¹å¤åˆ¶åˆ°ç›®æ ‡æœºå™¨
2. ç¡®ä¿ç›®æ ‡æœºå™¨å·²å®‰è£… Python 3.8+
3. è¿è¡Œ `install_offline.bat`
4. ç¼–è¾‘ `config/config.ini`
5. è¿è¡Œ `python main.py`

---

## âš¡ å¿«é€Ÿå¼€å§‹

### 1. é…ç½®æ–‡ä»¶

ç¼–è¾‘ `config/config.ini`ï¼š

```ini
[database]
type = postgresql    # postgresqlã€mysqlã€oracleã€sqlserver æˆ– gaussdb
host = localhost
port = 5432          # PostgreSQL/GaussDB é»˜è®¤ 5432ï¼ŒMySQL é»˜è®¤ 3306
database = your_database
user = postgres
password = your_password

[llm]
default_provider = deepseek

[deepseek]
api_key = sk-your-deepseek-api-key
model = deepseek-chat

[openai]
api_key = sk-your-openai-api-key
model = gpt-4o

[claude]
api_key = sk-ant-your-claude-api-key
model = claude-sonnet-4-20250514
```

### 2. å¯åŠ¨ CLI

```bash
python main.py
```

### 3. å¼€å§‹å¯¹è¯

```
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚  æ•°æ®åº“æ™ºèƒ½åŠ©æ‰‹ - DeepSeek / deepseek-chat â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

âœ“ å·²è¿æ¥: PostgreSQL 16.4

è¾“å…¥ /help æŸ¥çœ‹å¸®åŠ©ï¼Œ/model åˆ‡æ¢æ¨¡å‹ï¼Œ/language åˆ‡æ¢è¯­è¨€ï¼Œ/exit é€€å‡º

De> åˆ—å‡ºæ‰€æœ‰è¡¨
  â— åˆ—å‡ºè¡¨
    âœ“ è¿”å› 12 æ¡è®°å½•

â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ å½“å‰æ•°æ®åº“å…±æœ‰ 12 å¼ è¡¨ï¼š                                  â”‚
â”‚                                                         â”‚
â”‚ | è¡¨å | å¤§å° |                                          â”‚
â”‚ |------|------|                                          â”‚
â”‚ | users | 2.5 MB |                                       â”‚
â”‚ | orders | 15.8 MB |                                     â”‚
â”‚ | products | 1.2 MB |                                    â”‚
â”‚ | ...  | ... |                                           â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
```

### 4. å¸¸ç”¨å‘½ä»¤

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `/help` | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ |
| `/file [è·¯å¾„]` | åŠ è½½SQLæ–‡ä»¶è¿›è¡Œåˆ†æ |
| `/migrate` | æ•°æ®åº“è¿ç§»å‘å¯¼ï¼ˆæ–‡ä»¶å¯¼å…¥æˆ–åœ¨çº¿è¿ç§»ï¼‰ |
| `/sessions` | åˆ—å‡ºæ‰€æœ‰ä¼šè¯ |
| `/session new` | åˆ›å»ºæ–°ä¼šè¯ |
| `/session use <id/åç§°>` | åˆ‡æ¢åˆ°æŒ‡å®šä¼šè¯ |
| `/session delete <id/åç§°>` | åˆ é™¤ä¼šè¯ |
| `/session rename <åç§°>` | é‡å‘½åå½“å‰ä¼šè¯ |
| `/connections` | åˆ—å‡ºæ‰€æœ‰æ•°æ®åº“è¿æ¥ |
| `/connection add` | æ·»åŠ æ–°çš„æ•°æ®åº“è¿æ¥ |
| `/connection use <åç§°>` | åˆ‡æ¢åˆ°æŒ‡å®šæ•°æ®åº“è¿æ¥ |
| `/providers` | åˆ—å‡ºæ‰€æœ‰ AI æ¨¡å‹é…ç½® |
| `/provider add` | æ·»åŠ æ–°çš„ AI æ¨¡å‹é…ç½® |
| `/provider use <åç§°>` | åˆ‡æ¢ AI æ¨¡å‹ |
| `/model` | å¿«é€Ÿåˆ‡æ¢ AI æ¨¡å‹ |
| `/language` | åˆ‡æ¢è¯­è¨€ï¼ˆä¸­/è‹±ï¼‰ |
| `/reset` | é‡ç½®å¯¹è¯å†å² |
| `/history` | æŸ¥çœ‹å¯¹è¯å†å² |
| `/clear` | æ¸…å± |
| `/exit` | é€€å‡ºç¨‹åº |

### 5. SQL æ–‡ä»¶åˆ†æ

æ‚¨å¯ä»¥åŠ è½½ SQL æ–‡ä»¶ï¼Œè®© AI åˆ†ææˆ–æ‰§è¡Œï¼š

```
De> /file C:\queries\slow_queries.sql

å·²åŠ è½½æ–‡ä»¶: slow_queries.sql (2048 å­—èŠ‚, çº¦ 5 æ¡SQLè¯­å¥)

â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ æ–‡ä»¶é¢„è§ˆ - slow_queries.sql               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1  SELECT * FROM users                   â”‚
â”‚ 2  WHERE created_at > '2024-01-01'       â”‚
â”‚ 3  ORDER BY id;                          â”‚
â”‚ ...                                      â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

æ–‡ä»¶å·²åŠ è½½ï¼Œè¯·è¾“å…¥æ‚¨çš„é—®é¢˜...

De> åˆ†æè¿™äº›æŸ¥è¯¢çš„æ€§èƒ½

ğŸ¤–: æˆ‘æ¥åˆ†ææ–‡ä»¶ä¸­çš„æ¯æ¡æŸ¥è¯¢...
    [æ˜¾ç¤ºåˆ†æç»“æœ]

De> æ‰§è¡Œç¬¬2æ¡æŸ¥è¯¢

ğŸ¤–: [å±•ç¤ºSQLï¼Œç­‰å¾…ç¡®è®¤]
```

---

## ğŸ’¡ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ä¸€ï¼šå¼€å‘è€…æ—¥å¸¸æŸ¥è¯¢

**ä¼ ç»Ÿæ–¹å¼ï¼š** æ‰“å¼€æ•°æ®åº“å®¢æˆ·ç«¯ â†’ æŸ¥çœ‹è¡¨ç»“æ„ â†’ ç¼–å†™ SQL â†’ è°ƒè¯• â†’ æ‰§è¡Œ

**DB Agent æ–¹å¼ï¼š**
```
ğŸ‘¤: æŸ¥çœ‹æœ€è¿‘7å¤©æ¯å¤©çš„è®¢å•æ•°é‡å’Œæ€»é‡‘é¢

ğŸ¤–: å¥½çš„ï¼Œæˆ‘æ¥æŸ¥è¯¢æœ€è¿‘7å¤©çš„è®¢å•ç»Ÿè®¡...

    | æ—¥æœŸ | è®¢å•æ•° | æ€»é‡‘é¢ |
    |------|--------|--------|
    | 2024-01-20 | 156 | Â¥45,230.00 |
    | 2024-01-19 | 143 | Â¥38,920.00 |
    | ... | ... | ... |
```

### åœºæ™¯äºŒï¼šç´§æ€¥æ•…éšœæ’æŸ¥

**å‡Œæ™¨3ç‚¹ï¼Œç³»ç»Ÿå‘Šè­¦ï¼šæ•°æ®åº“å“åº”ç¼“æ…¢**

```
ğŸ‘¤: ç°åœ¨æœ‰å“ªäº›æ­£åœ¨æ‰§è¡Œçš„æ…¢æŸ¥è¯¢ï¼Ÿ

ğŸ¤–: å‘ç° 3 ä¸ªé•¿æ—¶é—´è¿è¡Œçš„æŸ¥è¯¢ï¼š

    1. PID: 12345 | è¿è¡Œæ—¶é—´: 45.2ç§’
       SELECT * FROM logs WHERE created_at > ...
       âš ï¸ é—®é¢˜ï¼šå…¨è¡¨æ‰«æ logs è¡¨ï¼ˆ2000ä¸‡è¡Œï¼‰

    2. PID: 12346 | è¿è¡Œæ—¶é—´: 23.8ç§’
       UPDATE orders SET status = ...
       âš ï¸ é—®é¢˜ï¼šé”ç­‰å¾…

    å»ºè®®ï¼š
    - è€ƒè™‘ç»ˆæ­¢ PID 12345
    - ä¸º logs.created_at æ·»åŠ ç´¢å¼•

ğŸ‘¤: å¸®æˆ‘åˆ›å»ºé‚£ä¸ªç´¢å¼•

ğŸ¤–: å°†åˆ›å»ºç´¢å¼•ï¼š
    CREATE INDEX CONCURRENTLY idx_logs_created_at ON logs(created_at);

    âš ï¸ è¿™æ˜¯ä¸€ä¸ªåœ¨çº¿åˆ›å»ºç´¢å¼•æ“ä½œï¼Œä¸ä¼šé”è¡¨ï¼Œä½†å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿã€‚
    ç¡®è®¤æ‰§è¡Œå—ï¼Ÿ[æ˜¯/å¦]
```

### åœºæ™¯ä¸‰ï¼šæ•°æ®åˆ†æå¸ˆææ•°

**äº§å“ç»ç†ï¼šæˆ‘éœ€è¦ä¸€ä»½ç”¨æˆ·åˆ†ææŠ¥å‘Š**

```
ğŸ‘¤: ç»Ÿè®¡æ¯ä¸ªç”¨æˆ·ç­‰çº§çš„ç”¨æˆ·æ•°é‡ã€å¹³å‡è®¢å•é‡‘é¢ã€æœ€åæ´»è·ƒæ—¶é—´åˆ†å¸ƒ

ğŸ¤–: å¥½çš„ï¼Œæˆ‘æ¥ç”Ÿæˆè¿™ä»½åˆ†ææŠ¥å‘Š...

    | ç”¨æˆ·ç­‰çº§ | ç”¨æˆ·æ•° | å¹³å‡è®¢å•é‡‘é¢ | 30å¤©å†…æ´»è·ƒ | 90å¤©å†…æ´»è·ƒ | ä¸æ´»è·ƒ |
    |---------|--------|-------------|-----------|-----------|--------|
    | VIP     | 1,234  | Â¥892.50     | 78%       | 15%       | 7%     |
    | é«˜çº§    | 5,678  | Â¥456.30     | 65%       | 22%       | 13%    |
    | æ™®é€š    | 23,456 | Â¥123.80     | 45%       | 30%       | 25%    |

    ğŸ’¡ æ´å¯Ÿï¼š
    - VIP ç”¨æˆ·æ´»è·ƒåº¦æœ€é«˜ï¼Œä½†å æ¯”ä»… 4%
    - æ™®é€šç”¨æˆ·ä¸­æœ‰ 25% å·²ä¸æ´»è·ƒï¼Œå»ºè®®è¿›è¡Œå¬å›è¥é”€
```

### åœºæ™¯å››ï¼šæ–°é¡¹ç›®è¡¨ç»“æ„è®¾è®¡

```
ğŸ‘¤: æˆ‘è¦åšä¸€ä¸ªåšå®¢ç³»ç»Ÿï¼Œå¸®æˆ‘è®¾è®¡æ•°æ®åº“è¡¨ç»“æ„

ğŸ¤–: å¥½çš„ï¼Œæˆ‘ä¸ºä½ è®¾è®¡ä»¥ä¸‹è¡¨ç»“æ„ï¼š

    1. **users** - ç”¨æˆ·è¡¨
       - id, username, email, password_hash, avatar, created_at

    2. **posts** - æ–‡ç« è¡¨
       - id, user_id, title, content, status, view_count, created_at, updated_at

    3. **categories** - åˆ†ç±»è¡¨
       - id, name, slug, parent_id

    4. **tags** - æ ‡ç­¾è¡¨
       - id, name, slug

    5. **post_tags** - æ–‡ç« æ ‡ç­¾å…³è”è¡¨
       - post_id, tag_id

    6. **comments** - è¯„è®ºè¡¨
       - id, post_id, user_id, content, parent_id, created_at

    éœ€è¦æˆ‘åˆ›å»ºè¿™äº›è¡¨å—ï¼Ÿæˆ‘å¯ä»¥ç”Ÿæˆå®Œæ•´çš„å»ºè¡¨è¯­å¥ã€‚

ğŸ‘¤: å¥½çš„ï¼Œåˆ›å»ºå§

ğŸ¤–: [å±•ç¤ºå®Œæ•´å»ºè¡¨ SQL]
    ç¡®è®¤æ‰§è¡Œå—ï¼Ÿ[æ˜¯/å¦]
```

### åœºæ™¯äº”ï¼šå®šæœŸç»´æŠ¤ä¼˜åŒ–

```
ğŸ‘¤: å¸®æˆ‘åšä¸€æ¬¡å…¨é¢çš„æ•°æ®åº“å¥åº·æ£€æŸ¥

ğŸ¤–: æ­£åœ¨è¿›è¡Œå…¨é¢æ£€æŸ¥...

    ğŸ“Š **æ•°æ®åº“æ¦‚å†µ**
    - ç‰ˆæœ¬ï¼šPostgreSQL 16.4
    - æ•°æ®åº“å¤§å°ï¼š12.5 GB
    - è¡¨æ•°é‡ï¼š45
    - æ´»è·ƒè¿æ¥ï¼š23

    âš ï¸ **å‘ç°çš„é—®é¢˜**

    1. **æ­»å…ƒç»„è¿‡å¤š** (3ä¸ªè¡¨)
       - orders: 15% æ­»å…ƒç»„ï¼Œå»ºè®® VACUUM
       - logs: 23% æ­»å…ƒç»„ï¼Œå»ºè®® VACUUM FULL
       - sessions: 45% æ­»å…ƒç»„ï¼Œç´§æ€¥ï¼

    2. **æœªä½¿ç”¨çš„ç´¢å¼•** (5ä¸ª)
       - idx_users_old_email: ä»æœªä½¿ç”¨ï¼Œå ç”¨ 56MB
       - idx_orders_legacy: ä»æœªä½¿ç”¨ï¼Œå ç”¨ 128MB
       ...

    3. **ç¼ºå°‘ç´¢å¼•** (2ä¸ªæŸ¥è¯¢)
       - orders.customer_id ç»å¸¸è¢«æŸ¥è¯¢ä½†æ— ç´¢å¼•
       - products.category_id ç»å¸¸è¢«æŸ¥è¯¢ä½†æ— ç´¢å¼•

    4. **å¤§è¡¨é¢„è­¦**
       - logs è¡¨å·²è¾¾ 5GBï¼Œå»ºè®®è€ƒè™‘åˆ†åŒºæˆ–å½’æ¡£

    âœ… **ä¼˜åŒ–å»ºè®®**
    1. ç«‹å³æ‰§è¡Œï¼šVACUUM ANALYZE sessions;
    2. è®¡åˆ’æ‰§è¡Œï¼šåˆ é™¤ 5 ä¸ªæœªä½¿ç”¨ç´¢å¼•ï¼Œé‡Šæ”¾ 280MB
    3. é•¿æœŸè§„åˆ’ï¼šlogs è¡¨æŒ‰æœˆåˆ†åŒº

    éœ€è¦æˆ‘æ‰§è¡Œè¿™äº›ä¼˜åŒ–æ“ä½œå—ï¼Ÿ
```

### åœºæ™¯å…­ï¼šéæŠ€æœ¯äººå‘˜ä½¿ç”¨

**è¿è¥åŒäº‹æƒ³æŸ¥æ•°æ®ï¼Œä½†ä¸ä¼šå†™ SQL**

```
ğŸ‘¤: æˆ‘æƒ³çœ‹çœ‹ä¸Šå‘¨é”€å”®é¢æœ€é«˜çš„10ä¸ªå•†å“

ğŸ¤–: å¥½çš„ï¼Œæˆ‘æ¥æŸ¥è¯¢ä¸Šå‘¨é”€å”®é¢ TOP 10 å•†å“...

    | æ’å | å•†å“åç§° | é”€é‡ | é”€å”®é¢ |
    |------|----------|------|--------|
    | 1 | iPhone 15 Pro | 234 | Â¥1,872,000 |
    | 2 | MacBook Air M3 | 156 | Â¥1,248,000 |
    | 3 | AirPods Pro 2 | 445 | Â¥889,110 |
    | ... | ... | ... | ... |

ğŸ‘¤: è¿™äº›å•†å“ä¸»è¦æ˜¯å“ªäº›åœ°åŒºçš„ç”¨æˆ·è´­ä¹°çš„ï¼Ÿ

ğŸ¤–: æˆ‘æ¥åˆ†æè¿™äº›çƒ­é”€å•†å“çš„è´­ä¹°åœ°åŒºåˆ†å¸ƒ...
    [AI è®°å¾—ä¸Šä¸‹æ–‡ï¼Œè‡ªåŠ¨åˆ†æè¿™ 10 ä¸ªå•†å“]
```

### åœºæ™¯ä¸ƒï¼šåœ¨çº¿æ•°æ®åº“è¿ç§»

**åœºæ™¯ï¼šå°† MySQL æ•°æ®åº“å¯¹è±¡åœ¨çº¿è¿ç§»åˆ° PostgreSQL**

ä½¿ç”¨ `/migrate` å‘½ä»¤è¿›è¡Œæ•°æ®åº“ä¹‹é—´çš„åœ¨çº¿è¿ç§»ã€‚DB Agent ä¼šåˆ†ææºæ•°æ®åº“ã€åˆ›å»ºè¿ç§»è®¡åˆ’ã€å¹¶å®æ—¶è·Ÿè¸ªè¿ç§»è¿›åº¦ã€‚

```
# é¦–å…ˆï¼Œæ·»åŠ ä¸¤ä¸ªæ•°æ®åº“è¿æ¥
De> /connection add
[é…ç½® MySQL æºæ•°æ®åº“]

De> /connection add
[é…ç½® PostgreSQL ç›®æ ‡æ•°æ®åº“]

# åˆ‡æ¢åˆ°ç›®æ ‡æ•°æ®åº“
De> /connection use postgres-target
âœ“ å·²åˆ‡æ¢åˆ°è¿æ¥ [postgres-target]

# å¯åŠ¨è¿ç§»å‘å¯¼
De> /migrate
1. æ–‡ä»¶å¯¼å…¥è¿ç§» - ä» SQL æ–‡ä»¶å¯¼å…¥å¹¶è½¬æ¢
2. åœ¨çº¿è¿ç§» - ç›´æ¥ä»æºæ•°æ®åº“è¿ç§»åˆ°ç›®æ ‡æ•°æ®åº“

é€‰æ‹©: 2

# é€‰æ‹©æºæ•°æ®åº“
å¯ç”¨çš„æºæ•°æ®åº“è¿æ¥ï¼š
| # | åç§° | ç±»å‹ | ä¸»æœº | æ•°æ®åº“ |
|---|------|------|------|--------|
| 1 | mysql-prod | MySQL | 192.168.1.100 | myapp |

é€‰æ‹©æºæ•°æ®åº“è¿æ¥: 1

è¿ç§»æ–¹å‘ï¼š
  mysql-prod (MySQL) â†’ postgres-target (PostgreSQL)

ç¡®è®¤å¼€å§‹è¿ç§»ï¼Ÿ[y/n]: y

ğŸ¤– Agent: æ­£åœ¨åˆ†ææºæ•°æ®åº“ mysql-prod...

       **æºæ•°æ®åº“åˆ†æï¼š**
       | å¯¹è±¡ç±»å‹ | æ•°é‡ |
       |----------|------|
       | è¡¨ | 7 |
       | è§†å›¾ | 3 |
       | å­˜å‚¨è¿‡ç¨‹ | 3 |
       | å‡½æ•° | 3 |
       | è§¦å‘å™¨ | 3 |
       | ç´¢å¼• | 12 |

       **è¿ç§»è®¡åˆ’ï¼š**
       å°†æŒ‰ä¾èµ–é¡ºåºåˆ›å»ºå¯¹è±¡ï¼š
       1. è¡¨ï¼ˆæŒ‰å¤–é”®é¡ºåºï¼‰
       2. ç´¢å¼•
       3. è§†å›¾
       4. å‡½æ•°
       5. å­˜å‚¨è¿‡ç¨‹
       6. è§¦å‘å™¨

       **DDL è½¬æ¢é¢„è§ˆï¼š**
       | MySQL | PostgreSQL |
       |-------|------------|
       | INT AUTO_INCREMENT | SERIAL |
       | VARCHAR(100) | VARCHAR(100) |
       | DATETIME | TIMESTAMP |
       | TINYINT(1) | BOOLEAN |
       | ENUM(...) | VARCHAR + CHECK |

       å‡†å¤‡æ‰§è¡Œ 31 ä¸ªè¿ç§»é¡¹ï¼Œç¡®è®¤ï¼Ÿ[æ˜¯/å¦]

ğŸ‘¤ ç”¨æˆ·: æ˜¯

ğŸ¤– Agent: æ­£åœ¨æ‰§è¡Œè¿ç§»...
       âœ“ [1/31] åˆ›å»ºè¡¨ users
       âœ“ [2/31] åˆ›å»ºè¡¨ departments
       âœ“ [3/31] åˆ›å»ºè¡¨ employees
       ...
       âœ“ [31/31] åˆ›å»ºè§¦å‘å™¨ tr_audit

       **è¿ç§»å®Œæˆï¼**
       - æ€»è®¡ï¼š31 é¡¹
       - æˆåŠŸï¼š31
       - å¤±è´¥ï¼š0
       - è·³è¿‡ï¼š0

       **éªŒè¯ï¼š**
       æ­£åœ¨æ¯”å¯¹æºæ•°æ®åº“å’Œç›®æ ‡æ•°æ®åº“...
       æ‰€æœ‰å¯¹è±¡è¿ç§»æˆåŠŸï¼
```

**æ”¯æŒçš„åœ¨çº¿è¿ç§»è·¯å¾„ï¼š**
- MySQL â†’ PostgreSQL / GaussDB / Oracle / SQL Server
- PostgreSQL â†’ MySQL / GaussDB / Oracle / SQL Server
- Oracle â†’ PostgreSQL / MySQL / GaussDB / SQL Server
- SQL Server â†’ PostgreSQL / MySQL / GaussDB / Oracle
- GaussDB â†’ PostgreSQL / MySQL / Oracle / SQL Server

### åœºæ™¯å…«ï¼šåŸºäºæ–‡ä»¶çš„æ•°æ®åº“è¿ç§»

**åœºæ™¯ï¼šä½¿ç”¨ DDL æ–‡ä»¶å°† Oracle æ•°æ®åº“å¯¹è±¡è¿ç§»åˆ° GaussDB**

ä½¿ç”¨ `/file` å‘½ä»¤åŠ è½½ Oracle DDL è„šæœ¬ï¼Œè®© AI è‡ªåŠ¨è½¬æ¢ä¸ºç›®æ ‡æ•°æ®åº“è¯­æ³•å¹¶æ‰§è¡Œã€‚

```
# å·²è¿æ¥ GaussDB
[database]
type = gaussdb
...

# åœ¨ CLI ä¸­åŠ è½½ Oracle DDL æ–‡ä»¶
De> /file C:\migration\oracle_schema.sql

âœ“ å·²åŠ è½½æ–‡ä»¶: oracle_schema.sql (15360 å­—èŠ‚, çº¦ 23 æ¡SQLè¯­å¥)

â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ æ–‡ä»¶é¢„è§ˆ - oracle_schema.sql                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1  -- Oracle DDL Script                          â”‚
â”‚ 2  CREATE TABLE employees (                       â”‚
â”‚ 3      emp_id NUMBER(10) PRIMARY KEY,            â”‚
â”‚ 4      emp_name VARCHAR2(100) NOT NULL,          â”‚
â”‚ 5      hire_date DATE DEFAULT SYSDATE,           â”‚
â”‚ 6      salary NUMBER(12,2),                      â”‚
â”‚ 7      dept_id NUMBER(10) REFERENCES departments â”‚
â”‚ 8  );                                            â”‚
â”‚ 9                                                â”‚
â”‚ 10 CREATE SEQUENCE emp_seq START WITH 1;         â”‚
â”‚ ...                                              â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

De> æŠŠè¿™äº› Oracle DDL è¯­å¥è½¬æ¢æˆ GaussDB è¯­æ³•å¹¶æ‰§è¡Œ

ğŸ¤–: æˆ‘æ¥åˆ†æ Oracle DDL å¹¶è½¬æ¢ä¸º GaussDB å…¼å®¹è¯­æ³•ï¼š

    **è½¬æ¢æ‘˜è¦ï¼š**

    | Oracle è¯­æ³• | GaussDB ç­‰æ•ˆè¯­æ³• |
    |------------|-----------------|
    | NUMBER(10) | INTEGER |
    | NUMBER(12,2) | DECIMAL(12,2) |
    | VARCHAR2(100) | VARCHAR(100) |
    | SYSDATE | CURRENT_DATE |
    | CREATE SEQUENCE | CREATE SEQUENCE (å…¼å®¹) |

    **è½¬æ¢åçš„ DDLï¼š**

    ```sql
    CREATE TABLE employees (
        emp_id INTEGER PRIMARY KEY,
        emp_name VARCHAR(100) NOT NULL,
        hire_date DATE DEFAULT CURRENT_DATE,
        salary DECIMAL(12,2),
        dept_id INTEGER REFERENCES departments
    );

    CREATE SEQUENCE emp_seq START WITH 1;
    ```

    å‡†å¤‡æ‰§è¡Œ 23 æ¡è½¬æ¢åçš„è¯­å¥ï¼Œç¡®è®¤æ‰§è¡Œå—ï¼Ÿ[æ˜¯/å¦]

ğŸ‘¤: æ˜¯

ğŸ¤–: æˆåŠŸåˆ›å»º 23 ä¸ªå¯¹è±¡ï¼š
    - 15 ä¸ªè¡¨
    - 5 ä¸ªåºåˆ—
    - 3 ä¸ªç´¢å¼•

    è¿ç§»å®Œæˆï¼
```

**æ”¯æŒçš„è¿ç§»è·¯å¾„ï¼š**
- **Oracle â†’ GaussDB**ï¼ˆä¼˜åŒ–æ”¯æŒï¼Œå†…ç½®è¯¦ç»†è½¬æ¢è§„åˆ™ï¼‰
- Oracle â†’ PostgreSQL / MySQL / SQL Server
- MySQL â†’ PostgreSQL / GaussDB / Oracle / SQL Server
- PostgreSQL â†’ MySQL / GaussDB / Oracle / SQL Server
- SQL Server â†’ PostgreSQL / MySQL / GaussDB / Oracle

### Oracle â†’ GaussDB æ ¸å¿ƒè½¬æ¢è§„åˆ™

DB Agent é’ˆå¯¹ Oracle åˆ° GaussDB çš„è¿ç§»å†…ç½®äº†è¯¦ç»†çš„è½¬æ¢è§„åˆ™ï¼š

| ç±»åˆ« | Oracle | GaussDB | è¯´æ˜ |
|------|--------|---------|------|
| **é«˜çº§åŒ…** | DBMS_LOB | DBE_LOB | ä¸æ”¯æŒ CLOB2FILE |
| | DBMS_OUTPUT | DBE_OUTPUT | æ¥å£ç”±å­˜å‚¨è¿‡ç¨‹å˜ä¸ºå‡½æ•° |
| | DBMS_RANDOM | DBE_RANDOM | SEEDâ†’SET_SEED, VALUEâ†’GET_VALUE |
| | UTL_RAW | DBE_RAW | å‡½æ•°åæ›´æ˜ç¡® |
| | DBMS_SQL | DBE_SQL | OPEN_CURSORâ†’REGISTER_CONTEXT |
| **æ•°æ®ç±»å‹** | NUMBER(p,-s) | ä¸æ”¯æŒ | éœ€æ‰‹åŠ¨ ROUND/TRUNC |
| | VARCHAR2(n CHAR) | VARCHAR2(n*4) | ä»…æ”¯æŒ BYTE å•ä½ |
| | DATE | TIMESTAMP(0) | æ³¨æ„ç²¾åº¦ä¸¢å¤± |
| **SQLè¯­æ³•** | ! = | != | ç¦æ­¢ç©ºæ ¼ï¼Œå¦åˆ™ ! è¢«è¯†åˆ«ä¸ºé˜¶ä¹˜ |
| | CONNECT BY | WITH RECURSIVE | å¤æ‚å±‚æ¬¡æŸ¥è¯¢æ”¹å†™ |
| | ROWNUM | ROW_NUMBER() | é¿å…åœ¨ JOIN ON ä¸­ä½¿ç”¨ |
| **å‡½æ•°** | ROUND(NULL,...) | æŠ¥é”™ | Oracle è¿”å› NULL |
| | '.' (æ­£åˆ™) | åŒ¹é…æ¢è¡Œ | Oracle é»˜è®¤ä¸åŒ¹é…æ¢è¡Œ |
| | LOWER/UPPER(æ—¥æœŸ) | æ ¼å¼ä¸åŒ | å»ºè®®å…ˆ TO_CHAR |

---

## âš™ï¸ é…ç½®è¯´æ˜

### æ•°æ®åº“é…ç½®

**PostgreSQL:**
```ini
[database]
type = postgresql     # æ•°æ®åº“ç±»å‹
host = localhost      # æ•°æ®åº“ä¸»æœº
port = 5432          # PostgreSQL é»˜è®¤ç«¯å£
database = mydb      # æ•°æ®åº“å
user = postgres      # ç”¨æˆ·å
password = secret    # å¯†ç 
```

**MySQL:**
```ini
[database]
type = mysql         # æ•°æ®åº“ç±»å‹
host = localhost     # æ•°æ®åº“ä¸»æœº
port = 3306          # MySQL é»˜è®¤ç«¯å£
database = mydb      # æ•°æ®åº“å
user = root          # ç”¨æˆ·å
password = secret    # å¯†ç 
```

**Oracle:**
```ini
[database]
type = oracle        # æ•°æ®åº“ç±»å‹
host = localhost     # æ•°æ®åº“ä¸»æœº
port = 1521          # Oracle é»˜è®¤ç«¯å£
database = ORCL      # Service Name æˆ– SID
user = system        # ç”¨æˆ·å
password = oracle    # å¯†ç 
```

> **Oracle é©±åŠ¨è¯´æ˜**
>
> ä½¿ç”¨ `oracledb` Thin æ¨¡å¼ï¼ˆOracle å®˜æ–¹ Python é©±åŠ¨ï¼‰ï¼š
> ```bash
> pip install oracledb
> ```
>
> **ç‰¹æ€§ï¼š**
> - çº¯ Python å®ç° - æ— éœ€å®‰è£… Oracle Client
> - æ”¯æŒ Oracle 12c åŠä»¥ä¸Šç‰ˆæœ¬ï¼ˆ12.1ã€12.2ã€18cã€19cã€21cã€23cï¼‰
> - ä¸æ”¯æŒ Oracle 11gï¼ˆéœ€è¦å®‰è£… Oracle Clientï¼‰
>
> **æ”¯æŒçš„åŠŸèƒ½ï¼š**
> - å®Œæ•´çš„è¡¨åˆ—è¡¨å’Œæ¨¡å¼æ¢ç´¢
> - é€šè¿‡ V$SQL åˆ†ææ…¢æŸ¥è¯¢
> - é€šè¿‡ DBMS_XPLAN åˆ†ææ‰§è¡Œè®¡åˆ’
> - ç´¢å¼•ä½¿ç”¨åˆ†æ
> - åœ¨çº¿ç´¢å¼•åˆ›å»ºï¼ˆONLINE å…³é”®å­—ï¼‰
> - é€šè¿‡ DBMS_STATS æ”¶é›†ç»Ÿè®¡ä¿¡æ¯
>
> **æƒé™è¯´æ˜ï¼š**
> - å»ºè®®ä½¿ç”¨ DBA æƒé™ä»¥è·å¾—å®Œæ•´åŠŸèƒ½
> - æ—  DBA æƒé™æ—¶ï¼Œå·¥å…·ä¼šè‡ªåŠ¨é™çº§ä½¿ç”¨ ALL_* è§†å›¾ä»£æ›¿ DBA_* è§†å›¾

**SQL Server:**
```ini
[database]
type = sqlserver     # æ•°æ®åº“ç±»å‹
host = localhost     # æ•°æ®åº“ä¸»æœº
port = 1433          # SQL Server é»˜è®¤ç«¯å£
database = mydb      # æ•°æ®åº“å
user = sa            # ç”¨æˆ·å
password = secret    # å¯†ç 
```

> **SQL Server é©±åŠ¨è¯´æ˜**
>
> ä½¿ç”¨ `pytds` (python-tds) - çº¯ Python TDS åè®®å®ç°ï¼š
> ```bash
> pip install python-tds
> ```
>
> **ç‰¹æ€§ï¼š**
> - çº¯ Python å®ç° - æ— éœ€å®‰è£… ODBC é©±åŠ¨
> - æ”¯æŒ SQL Server 2014ã€2016ã€2017ã€2019ã€2022 åŠ Azure SQL Database
> - æ”¯æŒ MARSï¼ˆå¤šæ´»åŠ¨ç»“æœé›†ï¼‰å’Œç°ä»£æ—¥æœŸç±»å‹
>
> **ç‰ˆæœ¬ç‰¹å®šåŠŸèƒ½ï¼š**
> - SQL Server 2014 (12.x)ï¼šåŸºç¡€æ”¯æŒ
> - SQL Server 2016 (13.x)+ï¼šQuery Store å†å²æŸ¥è¯¢åˆ†æ
> - SQL Server 2022 (16.x)ï¼šæ–°æƒé™æ¨¡å‹ (VIEW SERVER PERFORMANCE STATE)
> - Azure SQL Databaseï¼šå®Œæ•´æ”¯æŒï¼Œä½¿ç”¨ VIEW DATABASE STATE
>
> **æ”¯æŒçš„åŠŸèƒ½ï¼š**
> - å®Œæ•´çš„è¡¨åˆ—è¡¨å’Œæ¨¡å¼æ¢ç´¢
> - é€šè¿‡ sys.dm_exec_query_stats æˆ– Query Store è¿›è¡Œæ…¢æŸ¥è¯¢åˆ†æ
> - é€šè¿‡ SHOWPLAN_XML è¿›è¡Œæ‰§è¡Œè®¡åˆ’åˆ†æ
> - é€šè¿‡ sys.dm_db_index_usage_stats è¿›è¡Œç´¢å¼•ä½¿ç”¨åˆ†æ
> - åœ¨çº¿ç´¢å¼•åˆ›å»º (WITH ONLINE = ONï¼Œä»…ä¼ä¸šç‰ˆ)
> - é€šè¿‡ UPDATE STATISTICS æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
>
> **æƒé™è¯´æ˜ï¼š**
> - VIEW SERVER STATEï¼ˆ2019åŠä»¥å‰ï¼‰æˆ– VIEW SERVER PERFORMANCE STATEï¼ˆ2022+ï¼‰ç”¨äº DMV è®¿é—®
> - SHOWPLAN æƒé™ç”¨äºæ‰§è¡Œè®¡åˆ’åˆ†æ

**GaussDBï¼ˆåä¸ºï¼‰:**
```ini
[database]
type = gaussdb       # æ•°æ®åº“ç±»å‹
host = localhost     # æ•°æ®åº“ä¸»æœº
port = 5432          # GaussDB é»˜è®¤ç«¯å£ï¼ˆä¸ PostgreSQL ç›¸åŒï¼‰
database = postgres  # æ•°æ®åº“å
user = gaussdb       # ç”¨æˆ·å
password = secret    # å¯†ç 
```

> **GaussDB é©±åŠ¨å®‰è£…è¯´æ˜**
>
> **é»˜è®¤æ–¹å¼ï¼ˆæ‰€æœ‰å¹³å°ï¼‰ï¼š** ä½¿ç”¨ pg8000 é©±åŠ¨ï¼Œæ”¯æŒ sha256 è®¤è¯ï¼ˆå·²åŒ…å«åœ¨ requirements.txt ä¸­ï¼‰ï¼š
> ```bash
> pip install pg8000
> ```
>
> **Linuxï¼ˆæ¬§æ‹‰ç³»ç»Ÿï¼‰å¤‡é€‰æ–¹æ¡ˆï¼š** ä¹Ÿå¯ä½¿ç”¨åä¸ºæä¾›çš„ä¸“ç”¨é©±åŠ¨ï¼š
> ```bash
> # 1. è§£å‹é©±åŠ¨åŒ…ï¼ˆç”±åä¸ºæä¾›ï¼‰
> tar -zxvf GaussDB-Kernel-V500R002C10-EULER-64bit-Python.tar.gz
>
> # 2. å¤åˆ¶ psycopg2 åˆ° Python site-packages
> cp -r psycopg2 /usr/lib/python3.x/site-packages/
>
> # 3. è®¾ç½®æƒé™
> chmod 755 /usr/lib/python3.x/site-packages/psycopg2
>
> # 4. é…ç½®ç¯å¢ƒå˜é‡
> export LD_LIBRARY_PATH=/path/to/gaussdb/lib:$LD_LIBRARY_PATH
> export PYTHONPATH=/path/to/gaussdb:$PYTHONPATH
> ```
>
> **æ”¯æŒçš„æ¨¡å¼ï¼š**
> - **é›†ä¸­å¼æ¨¡å¼**ï¼šå•èŠ‚ç‚¹æˆ–é«˜å¯ç”¨é›†ç¾¤ï¼Œé€‚åˆ OLTP åœºæ™¯ã€‚ä½¿ç”¨ `PG_STAT_ACTIVITY` è¿›è¡Œç›‘æ§ã€‚
> - **åˆ†å¸ƒå¼æ¨¡å¼**ï¼šMPP æ¶æ„å¤šèŠ‚ç‚¹ï¼Œé€‚åˆ OLAP åœºæ™¯ã€‚ä½¿ç”¨ `PGXC_STAT_ACTIVITY` è¿›è¡Œè·¨èŠ‚ç‚¹ç›‘æ§ã€‚
>
> ç³»ç»Ÿä¼šæ ¹æ® `pgxc_node` ç³»ç»Ÿè¡¨è‡ªåŠ¨æ£€æµ‹è¿è¡Œæ¨¡å¼ã€‚

### LLM æä¾›å•†é…ç½®

æ”¯æŒçš„æä¾›å•†åŠé…ç½®æ–¹å¼ï¼š

#### DeepSeekï¼ˆæ¨èï¼Œæ€§ä»·æ¯”é«˜ï¼‰
```ini
[deepseek]
api_key = sk-your-api-key
model = deepseek-chat
```

#### OpenAI / ChatGPT
```ini
[openai]
api_key = sk-your-api-key
model = gpt-4o
```

#### Anthropic Claude
```ini
[claude]
api_key = sk-ant-your-api-key
model = claude-sonnet-4-20250514
```

#### Google Gemini
```ini
[gemini]
api_key = your-api-key
model = gemini-pro
```

#### é˜¿é‡Œäº‘é€šä¹‰åƒé—®
```ini
[qwen]
api_key = your-api-key
model = qwen-turbo
```

#### Ollamaï¼ˆæœ¬åœ°éƒ¨ç½²ï¼Œå…è´¹ï¼‰
```ini
[ollama]
api_key = ollama
model = llama2
base_url = http://localhost:11434/v1
```

---

## ğŸŒ API æœåŠ¡

DB Agent æä¾› RESTful APIï¼Œæ–¹ä¾¿é›†æˆåˆ°å…¶ä»–ç³»ç»Ÿã€‚

### å¯åŠ¨ API æœåŠ¡

```bash
python -m db_agent.api.server
# æˆ–æŒ‡å®šç«¯å£
PORT=8080 python -m db_agent.api.server
```

### API ç«¯ç‚¹

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | `/api/v1/sessions` | åˆ›å»ºä¼šè¯ |
| POST | `/api/v1/chat` | å‘é€æ¶ˆæ¯ |
| GET | `/api/v1/sessions` | åˆ—å‡ºä¼šè¯ |
| GET | `/api/v1/sessions/{id}/history` | è·å–å†å² |
| DELETE | `/api/v1/sessions/{id}` | åˆ é™¤ä¼šè¯ |
| POST | `/api/v1/sessions/{id}/reset` | é‡ç½®ä¼šè¯ |
| GET | `/api/v1/health` | å¥åº·æ£€æŸ¥ |

### ä½¿ç”¨ç¤ºä¾‹

```python
import requests

BASE_URL = "http://localhost:8000"

# 1. åˆ›å»ºä¼šè¯
resp = requests.post(f"{BASE_URL}/api/v1/sessions", json={
    "config": {
        "db_type": "postgresql",  # æˆ– "mysql" æˆ– "gaussdb"
        "db_host": "localhost",
        "db_port": 5432,          # PostgreSQL/GaussDB 5432ï¼ŒMySQL 3306
        "db_name": "mydb",
        "db_user": "postgres",
        "db_password": "secret"
    }
})
session_id = resp.json()["session_id"]
print(f"ä¼šè¯ID: {session_id}")

# 2. å‘é€æ¶ˆæ¯
resp = requests.post(f"{BASE_URL}/api/v1/chat", json={
    "session_id": session_id,
    "message": "åˆ—å‡ºæ‰€æœ‰è¡¨"
})
print(resp.json()["response"])

# 3. ç»§ç»­å¯¹è¯ï¼ˆAI ä¼šè®°ä½ä¸Šä¸‹æ–‡ï¼‰
resp = requests.post(f"{BASE_URL}/api/v1/chat", json={
    "session_id": session_id,
    "message": "ç¬¬ä¸€ä¸ªè¡¨æœ‰å¤šå°‘æ¡æ•°æ®ï¼Ÿ"
})
print(resp.json()["response"])

# 4. åˆ é™¤ä¼šè¯
requests.delete(f"{BASE_URL}/api/v1/sessions/{session_id}")
```

### API æ–‡æ¡£

å¯åŠ¨æœåŠ¡åè®¿é—®ï¼š
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

---

## ğŸ”’ å®‰å…¨æœºåˆ¶

### 1. æ“ä½œç¡®è®¤æœºåˆ¶

æ‰€æœ‰å±é™©æ“ä½œï¼ˆINSERT / UPDATE / DELETE / DROP / CREATE ç­‰ï¼‰éƒ½éœ€è¦ç”¨æˆ·äºŒæ¬¡ç¡®è®¤ï¼š

```
ğŸ¤–: å³å°†æ‰§è¡Œä»¥ä¸‹ SQLï¼š

    DELETE FROM users WHERE status = 'inactive';

    âš ï¸ æ­¤æ“ä½œå°†å½±å“ 1,234 è¡Œæ•°æ®
    ç¡®è®¤æ‰§è¡Œå—ï¼Ÿ[æ˜¯/å¦]
```

### 2. åªè¯»æŸ¥è¯¢ä¿æŠ¤

`execute_safe_query` å·¥å…·å…è®¸åªè¯»è¯­å¥æ— éœ€ç¡®è®¤ç›´æ¥æ‰§è¡Œï¼š

```python
# åªè¯»è¯­å¥ç›´æ¥æ‰§è¡Œ
result = db_tools.execute_safe_query("SELECT * FROM users")      # âœ…
result = db_tools.execute_safe_query("SHOW TABLES")              # âœ… (MySQL)
result = db_tools.execute_safe_query("DESCRIBE users")           # âœ… (MySQL)
result = db_tools.execute_safe_query("EXPLAIN SELECT * FROM t")  # âœ…
result = db_tools.execute_safe_query("DELETE FROM users")        # âŒ è¢«æ‹’ç»
```

**æ”¯æŒçš„åªè¯»è¯­å¥ï¼š**
- `SELECT` - æ•°æ®æŸ¥è¯¢
- `SHOW` - æŸ¥çœ‹æ•°æ®åº“å¯¹è±¡ (MySQL)
- `DESCRIBE` / `DESC` - æŸ¥çœ‹è¡¨ç»“æ„ (MySQL)
- `EXPLAIN` - æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’

### 3. ç´¢å¼•åˆ›å»ºä¿æŠ¤

é»˜è®¤ä½¿ç”¨åœ¨çº¿ DDL åˆ›å»ºç´¢å¼•ï¼Œæœ€å°åŒ–é”è¡¨ï¼š

**PostgreSQL:**
```sql
-- Agent è‡ªåŠ¨è½¬æ¢ä¸ºï¼š
CREATE INDEX CONCURRENTLY idx_name ON table(column);
```

**MySQL (5.6+):**
```sql
-- Agent è‡ªåŠ¨è½¬æ¢ä¸ºï¼š
ALTER TABLE table ADD INDEX idx_name (column), ALGORITHM=INPLACE, LOCK=NONE;
```

### 4. æ•°æ®åº“ç‰ˆæœ¬æ„ŸçŸ¥

Agent è‡ªåŠ¨æ£€æµ‹æ•°æ®åº“ç‰ˆæœ¬ï¼Œç”Ÿæˆå…¼å®¹çš„ SQLï¼š

```
ğŸ¤–: æ£€æµ‹åˆ° PostgreSQL 16.4
    å°†ä½¿ç”¨å…¼å®¹æ­¤ç‰ˆæœ¬çš„ SQL è¯­æ³•
```

### 5. æ™ºèƒ½é”™è¯¯æ¢å¤

å½“ SQL æ‰§è¡Œå¤±è´¥æ—¶ï¼ŒAgent ä¼šè‡ªåŠ¨åˆ†æé”™è¯¯åŸå› ï¼Œè°ƒæ•´ç­–ç•¥åé‡è¯•ï¼š

```
ğŸ‘¤: å¾€ users è¡¨æ’å…¥æµ‹è¯•æ•°æ®

ğŸ¤–: å¥½çš„ï¼Œæˆ‘æ¥æ’å…¥ 100 æ¡æµ‹è¯•è®°å½•...
    [å±•ç¤º INSERT SQLï¼Œç­‰å¾…ç¡®è®¤]

ğŸ‘¤: æ˜¯

ğŸ¤–: é”™è¯¯ï¼šDuplicate entry 'user001' for key 'users.username'

    æ£€æµ‹åˆ°é‡å¤é”®é”™è¯¯ï¼Œæˆ‘æ¥è°ƒæ•´ç­–ç•¥å¤„ç†å·²å­˜åœ¨çš„è®°å½•...

    [å±•ç¤ºä¿®æ”¹åçš„ SQLï¼ˆä½¿ç”¨ INSERT IGNOREï¼‰ï¼Œç­‰å¾…ç¡®è®¤]

ğŸ‘¤: æ˜¯

ğŸ¤–: æˆåŠŸæ’å…¥ 95 æ¡æ–°è®°å½•ï¼ˆè·³è¿‡ 5 æ¡é‡å¤æ•°æ®ï¼‰ã€‚
    ç»§ç»­æ‰§è¡Œä¸‹ä¸€æ­¥...
```

**é”™è¯¯æ¢å¤ç­–ç•¥ï¼š**
- **é‡å¤é”®é”™è¯¯** - ä½¿ç”¨ `INSERT IGNORE` æˆ– `ON DUPLICATE KEY UPDATE`
- **çº¦æŸè¿å** - åˆ†æå¹¶ä¿®æ­£æ•°æ®ï¼Œä½¿ç”¨ä¿®æ­£åçš„ SQL é‡è¯•
- **è¯­æ³•é”™è¯¯** - ä¿®æ­£ SQL è¯­æ³•åé‡è¯•
- **è¡¨/åˆ—ä¸å­˜åœ¨** - å…ˆç¡®è®¤ç»“æ„ï¼Œå†è°ƒæ•´æŸ¥è¯¢

---

## â“ å¸¸è§é—®é¢˜

### Q: æ”¯æŒå“ªäº›æ•°æ®åº“ï¼Ÿ
**A:** ç›®å‰æ”¯æŒ PostgreSQL 12+ã€MySQL 5.7/8.0ã€Oracle 12c+ã€SQL Server 2014+ï¼ˆåŒ…æ‹¬ Azure SQLï¼‰å’Œ GaussDBï¼ˆé›†ä¸­å¼å’Œåˆ†å¸ƒå¼æ¨¡å¼ï¼‰ã€‚

### Q: ä¼šä¸ä¼šè¯¯æ“ä½œåˆ é™¤æ•°æ®ï¼Ÿ
**A:** ä¸ä¼šã€‚æ‰€æœ‰ INSERT/UPDATE/DELETE/DROP ç­‰å±é™©æ“ä½œéƒ½éœ€è¦äºŒæ¬¡ç¡®è®¤ï¼Œä½ å¯ä»¥é¢„è§ˆå°†è¦æ‰§è¡Œçš„ SQL åå†å†³å®šæ˜¯å¦æ‰§è¡Œã€‚

### Q: API Key å®‰å…¨å—ï¼Ÿ
**A:** API Key å­˜å‚¨åœ¨æœ¬åœ°é…ç½®æ–‡ä»¶ä¸­ï¼Œä¸ä¼šä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨ã€‚å»ºè®®è®¾ç½®é€‚å½“çš„æ–‡ä»¶æƒé™ä¿æŠ¤é…ç½®æ–‡ä»¶ã€‚

### Q: å¯ä»¥è¿æ¥è¿œç¨‹æ•°æ®åº“å—ï¼Ÿ
**A:** å¯ä»¥ã€‚åœ¨é…ç½®æ–‡ä»¶ä¸­å¡«å†™è¿œç¨‹æ•°æ®åº“çš„åœ°å€å’Œå‡­æ®å³å¯ã€‚è¯·ç¡®ä¿ç½‘ç»œå¯è¾¾ä¸”é˜²ç«å¢™å…è®¸è¿æ¥ã€‚

### Q: æ”¯æŒå¤šæ•°æ®åº“åˆ‡æ¢å—ï¼Ÿ
**A:** æ”¯æŒï¼ä½ å¯ä»¥ç®¡ç†å¤šä¸ªæ•°æ®åº“è¿æ¥ï¼Œå¹¶åœ¨è¿è¡Œæ—¶è‡ªç”±åˆ‡æ¢ï¼š
```
/connection add           # æ·»åŠ æ–°è¿æ¥
/connections              # åˆ—å‡ºæ‰€æœ‰è¿æ¥
/connection use <åç§°>    # åˆ‡æ¢åˆ°å…¶ä»–æ•°æ®åº“
```

### Q: å¯¹è¯å†å²ä¼šä¿å­˜å—ï¼Ÿ
**A:** ä¼šçš„ï¼Œæ‰€æœ‰å¯¹è¯éƒ½ä¼šè‡ªåŠ¨ä¿å­˜åˆ°æœ¬åœ° SQLite æ•°æ®åº“ä¸­ã€‚ä½ å¯ä»¥ï¼š
- ä½¿ç”¨ `/session use <åç§°>` ç»§ç»­ä¹‹å‰çš„ä¼šè¯
- ä½¿ç”¨ `/sessions` æŸ¥çœ‹æ‰€æœ‰ä¼šè¯
- ä½¿ç”¨ `/session new` åˆ›å»ºæ–°ä¼šè¯
- é‡å¯ç¨‹åºåå¯¹è¯å†å²ä»ç„¶ä¿ç•™

### Q: å¦‚ä½•å¤„ç†å¤§ç»“æœé›†ï¼Ÿ
**A:** Agent ä¼šè‡ªåŠ¨é™åˆ¶è¿”å›çš„æ•°æ®é‡ã€‚å¦‚éœ€æŸ¥çœ‹æ›´å¤šæ•°æ®ï¼Œå¯ä»¥æ˜ç¡®å‘Šè¯‰ Agent ä½ éœ€è¦å¤šå°‘æ¡è®°å½•ã€‚

### Q: pg_stat_statements æœªå¯ç”¨æ€ä¹ˆåŠï¼Ÿï¼ˆPostgreSQLï¼‰
**A:** ä¸å½±å“ä½¿ç”¨ã€‚Agent ä¼šè‡ªåŠ¨é™çº§ä½¿ç”¨ `pg_stat_activity` æ¥æŸ¥çœ‹å½“å‰æŸ¥è¯¢ã€‚å¦‚éœ€å†å²æ…¢æŸ¥è¯¢åˆ†æï¼Œè¯·å¯ç”¨ pg_stat_statementsï¼š

```sql
-- postgresql.conf
shared_preload_libraries = 'pg_stat_statements'

-- é‡å¯åæ‰§è¡Œ
CREATE EXTENSION pg_stat_statements;
```

### Q: performance_schema æœªå¯ç”¨æ€ä¹ˆåŠï¼Ÿï¼ˆMySQLï¼‰
**A:** ä¸å½±å“åŸºæœ¬ä½¿ç”¨ã€‚Agent ä¼šè‡ªåŠ¨é™çº§ä½¿ç”¨ `information_schema.PROCESSLIST` æ¥æŸ¥çœ‹å½“å‰æŸ¥è¯¢ã€‚å¦‚éœ€è¯¦ç»†çš„æ…¢æŸ¥è¯¢åˆ†æï¼Œè¯·åœ¨ MySQL é…ç½®ä¸­å¯ç”¨ performance_schemaï¼š

```ini
# my.cnf
[mysqld]
performance_schema = ON
```

### Q: ä½¿ç”¨å“ªä¸ª LLM æ¨¡å‹æ•ˆæœæœ€å¥½ï¼Ÿ
**A:** æ¨èï¼š
- **æ€§ä»·æ¯”é¦–é€‰**: DeepSeekï¼ˆä¾¿å®œä¸”æ•ˆæœå¥½ï¼‰
- **æ•ˆæœæœ€ä½³**: Claude Sonnet æˆ– GPT-4o
- **å…è´¹æ–¹æ¡ˆ**: Ollama æœ¬åœ°éƒ¨ç½² Llama2

---

## ğŸ›  Agent å·¥å…·é›†

Agent å¯è‡ªåŠ¨è°ƒç”¨ä»¥ä¸‹æ•°æ®åº“å·¥å…·ï¼š

### æŸ¥è¯¢ä¸æ“ä½œå·¥å…·

| å·¥å…· | è¯´æ˜ | ç”¨é€” |
|------|------|------|
| `list_tables` | åˆ—å‡ºæ‰€æœ‰è¡¨ | äº†è§£æ•°æ®åº“ç»“æ„ |
| `describe_table` | æŸ¥çœ‹è¡¨ç»“æ„ | äº†è§£å­—æ®µä¿¡æ¯ |
| `get_sample_data` | è·å–ç¤ºä¾‹æ•°æ® | äº†è§£æ•°æ®æ ¼å¼ |
| `execute_sql` | æ‰§è¡Œä»»æ„ SQL | å¢åˆ æ”¹æŸ¥æ“ä½œ |
| `execute_safe_query` | æ‰§è¡Œåªè¯»æŸ¥è¯¢ | å®‰å…¨æŸ¥è¯¢æ•°æ® |

### æ€§èƒ½å·¥å…·

| å·¥å…· | è¯´æ˜ | ç”¨é€” |
|------|------|------|
| `run_explain` | åˆ†ææ‰§è¡Œè®¡åˆ’ | æ€§èƒ½è¯Šæ–­ |
| `check_index_usage` | æ£€æŸ¥ç´¢å¼•ä½¿ç”¨ | ç´¢å¼•ä¼˜åŒ– |
| `get_table_stats` | è·å–è¡¨ç»Ÿè®¡ | å¥åº·æ£€æŸ¥ |
| `create_index` | åˆ›å»ºç´¢å¼• | æ€§èƒ½ä¼˜åŒ– |
| `analyze_table` | æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ | ç»´æŠ¤ä¼˜åŒ– |
| `identify_slow_queries` | è¯†åˆ«æ…¢æŸ¥è¯¢ | æ€§èƒ½è¯Šæ–­ |
| `get_running_queries` | æŸ¥çœ‹è¿è¡Œä¸­æŸ¥è¯¢ | å®æ—¶ç›‘æ§ |

### è¿ç§»å·¥å…·

| å·¥å…· | è¯´æ˜ | ç”¨é€” |
|------|------|------|
| `analyze_source_database` | åˆ†ææºæ•°æ®åº“å¯¹è±¡ | è¿ç§»è§„åˆ’ |
| `create_migration_plan` | åˆ›å»ºè¿ç§»è®¡åˆ’å¹¶è½¬æ¢DDL | è¿ç§»å‡†å¤‡ |
| `execute_migration_batch` | æ‰¹é‡æ‰§è¡Œè¿ç§»é¡¹ | è¿ç§»æ‰§è¡Œ |
| `compare_databases` | æ¯”å¯¹æºåº“å’Œç›®æ ‡åº“ | è¿ç§»éªŒè¯ |
| `generate_migration_report` | ç”Ÿæˆè¿ç§»æŠ¥å‘Š | è¿ç§»æ–‡æ¡£ |
| `get_migration_status` | è·å–è¿ç§»è¿›åº¦ | è¿›åº¦è·Ÿè¸ª |

---

## ğŸ“„ å¼€æºåè®®

æœ¬é¡¹ç›®é‡‡ç”¨ MIT åè®®å¼€æºã€‚

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. æäº¤ Pull Request

---

## ğŸ“® è”ç³»æˆ‘ä»¬

- æäº¤ Issue: [GitHub Issues](https://github.com/NoNamesJavaDog/db-agent-ai/issues)
- é‚®ç®±: 1057135186@qq.com

---

<p align="center">
  <b>ğŸš€ è®©æ¯ä¸ªäººéƒ½èƒ½è½»æ¾ç®¡ç†æ•°æ®åº“ï¼Œè®© DBA å»åšæ›´æœ‰ä»·å€¼çš„äº‹</b><br><br>
  <sub>Built with â¤ï¸ by DB Agent Team</sub>
</p>
